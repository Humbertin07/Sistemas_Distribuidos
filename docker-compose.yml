version: '3.8'

services:
  ref_server:
    build: ./ref_server
    container_name: ref_server
    ports:
      - "5559:5559"
    networks:
      - chat_network
    volumes:
      - ./server_data:/data

  broker:
    build: ./broker
    container_name: broker
    ports:
      - "5656:5556"  # ‚Üê Porta externa diferente
    networks:
      - chat_network

  proxy:
    build: ./proxy
    container_name: proxy
    ports:
      - "5557:5557"
      - "5558:5558"
    networks:
      - chat_network

  server_1:
    build: ./server
    container_name: server_1
    depends_on:
      - broker
      - proxy
      - ref_server
    networks:
      - chat_network
    volumes:
      - ./server_data:/data

  server_2:
    build: ./server
    container_name: server_2
    depends_on:
      - broker
      - proxy
      - ref_server
    networks:
      - chat_network
    volumes:
      - ./server_data:/data

  server_3:
    build: ./server
    container_name: server_3
    depends_on:
      - broker
      - proxy
      - ref_server
    networks:
      - chat_network
    volumes:
      - ./server_data:/data

  # Cliente Python
  client:
    build: ./client_py
    container_name: client
    depends_on:
      - broker
      - proxy
    stdin_open: true
    tty: true
    networks:
      - chat_network

  # Bots
  bot_client_1:
    build: ./bot
    container_name: bot_client_1
    depends_on:
      - broker
      - proxy
      - server_1
      - server_2
      - server_3
    networks:
      - chat_network

  bot_client_2:
    build: ./bot
    container_name: bot_client_2
    depends_on:
      - broker
      - proxy
      - server_1
      - server_2
      - server_3
    networks:
      - chat_network

networks:
  chat_network:
    driver: bridge